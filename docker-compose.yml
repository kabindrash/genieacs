services:
  mongodb:
    image: mongo:6
    volumes:
      - mongodb-data:/data/db
    ports:
      - "27017:27017"

  genieacs-cwmp:
    build: .
    command: ["node", "bin/genieacs-cwmp"]
    depends_on: [mongodb]
    environment:
      GENIEACS_MONGODB_CONNECTION_URL: mongodb://mongodb/genieacs
      GENIEACS_CWMP_ACCESS_LOG_FILE: /dev/null
      GENIEACS_EXT_DIR: /app/config/ext
    ports:
      - "7547:7547"

  genieacs-nbi:
    build: .
    command: ["node", "bin/genieacs-nbi"]
    depends_on: [mongodb]
    environment:
      GENIEACS_MONGODB_CONNECTION_URL: mongodb://mongodb/genieacs
      GENIEACS_NBI_ACCESS_LOG_FILE: /dev/null
    ports:
      - "7557:7557"

  genieacs-fs:
    build: .
    command: ["node", "bin/genieacs-fs"]
    depends_on: [mongodb]
    environment:
      GENIEACS_MONGODB_CONNECTION_URL: mongodb://mongodb/genieacs
      GENIEACS_FS_ACCESS_LOG_FILE: /dev/null
    ports:
      - "7567:7567"

  genieacs-ui:
    build: .
    command: ["node", "bin/genieacs-ui"]
    depends_on: [mongodb]
    environment:
      GENIEACS_MONGODB_CONNECTION_URL: mongodb://mongodb/genieacs
      GENIEACS_UI_JWT_SECRET: changeme
    ports:
      - "3001:3000"

  provision-deployer:
    image: curlimages/curl:latest
    depends_on: [genieacs-nbi]
    volumes:
      - ./provisions:/provisions:ro
    entrypoint: ["/bin/sh", "/provisions/deploy.sh"]
    environment:
      NBI_URL: http://genieacs-nbi:7557

volumes:
  mongodb-data:

networks:
  default:
    name: genieacs_default
